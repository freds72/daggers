pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--devil daggers daggercollect
--by ridgek

--copy pattern 63 - sfx 7 to title.p8
cstore(0x2800, 0x31fc, 4 + 68 * 8, "../carts/title.p8")

--sfx
--4: daggercollect
--5: daggercollect
--6: daggercollect
--7: daggercollect

--music
--63: daggercollect

-->8
---remove unused instrument sfx
--call cstore(0x3200,0x3200,0x1100) to save
--
-- @param sfxstart {integer} start of sfx range to remove
-- @param sfxend {integer} end of sfx range to remove
function rm_unused_instruments(sfxstart, sfxend)
	--store removed sfx indexes
	local removed = {}

	--loop through instrument sfx
	for i = 0, 7 do
		--loop through
		--all non-instrument sfx
		for sfx_num = sfxstart or 8, sfxend or 63 do
			local addr = 0x3200 + sfx_num * 68

			--loop through all notes
			for note_num = 0, 31 do
				--get note from ram
				local note = peek2(addr + note_num * 2)
				--calculate waveform bits
				local waveform = i << 8

				if
					--note waveform
					--is instrument i
					note & waveform == waveform
					--note uses
					--a custom instrument
					and note & 0x8000 ~= 0
				then
					goto continue
				end
			end
		end

		sfx_reset(i)

		add(removed, i)

		::continue::
	end

	--print results
	if #removed > 0 then
		printh"removed sfx:"
		print"removed sfx:"

		for v in all(removed) do
			printh(v)
			print(v)
		end
	else
		print"ok"
	end
end

---transpose sfx
-- @param semitones {integer} number of semitones to transpose up or down
-- @param sfxstart {integer} start of sfx range to transpose
-- @param sfxend {integer} end of sfx range to transpose
function transpose(semitones, sfxstart, sfxend)
	for i=0x3200 + sfxstart * 68, 0x3200 + ((sfxend + 1) * 68) - 1, 68 do
		for j=i, i+63, 2 do
			local byte = peek(j)
			local pitch = 0x3f & byte
			local newpitch = mid(0, pitch + semitones, 63)

			poke(j, (0xc0 & byte) | newpitch)
		end
	end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
450211200047000470004400044000400004000046000460004520045200462004620040000400003720047200400004000037000470004700040000372004720040000400003700047000470004000037200472
090115203e0323d0313c0313d0413b0413e0413d0313c0313c0213b0213b0113c0113b0113b0113c0113b0113b0123b0123c0113b0123c0113c7123c7123c7103c7123c7123c7103c7123c7103c7103c7123c712
450204081844018440184101841018440184401842018420184401844018410184101844018440184101841018400184001835018450184501840018352184521840018400183501845018450184001835218452
c10100011871100700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700007000070000700
39070000100500d9600d9510d9510d9510d9510d9510d9410d9410d9410d9310d9310d9210d91121811238211883123841238322483223832248322183221832218311e8321e8311e8311c8311c8321b82518811
c10700001b9721b9711996119961199611996219952199521995219942199321992224a1426a2524a212ba212ba212fa2104a212fa252fa252fa252fa2525a2125a2127a1527a1527a1526a1526a151b9001a900
810700001da00117001c9621e9511e9411e9411e9311e9321e9221e9221e9121e91230a1432a1134a2135a2137a2137a1135a1235a1535a1535a1530a112da1129a112ba151ea151ea151ea151ea111ea111ea11
31070000000000000000000000001db111db111db211db211db311db311db312fa142fa122fa121db621db711db111db111db211db211db311db311db411db411db511db511db611db711db511db611db511db11
__music__
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 41424344
00 04050607

